# 5.4. 機能仕様書: 参加者管理

## 機能概要
プロジェクトの作成者や編集権限を持つユーザーは、他のユーザーをプロジェクトに招待できる。また、参加者の権限（ロール）を変更したり、プロジェクトから削除したりすることができる。

---

### ユーザーストーリー
- プロジェクトの管理者として、新しいメンバーをプロジェクトに招待したい。なぜなら、共同でタスクを管理したいからだ。
- プロジェクトの管理者として、メンバーの権限を「編集可能」から「閲覧のみ」に変更したい。なぜなら、役割に応じて操作範囲を制限したいからだ。

---

### 画面構成要素
- **招待フォーム**:
  - プロジェクト設定ページ内に配置する。
  - 招待したいユーザーのメールアドレスを入力するフォーム。
  - 権限（「編集可能」/「閲覧のみ」）を選択するドロップダウン。
  - 「招待」ボタン。
- **参加者一覧**:
  - 現在プロジェクトに参加しているユーザーのリスト。
  - ユーザーのアイコン、名前、メールアドレス、現在の権限を表示する。
  - 各ユーザーの横に、権限を変更するためのドロップダウンと、プロジェクトから削除するための「削除」ボタンを配置する。

---

### 正常系フロー（ユーザー招待）
1.  ユーザーはプロジェクト詳細ページの設定メニューから「参加者管理」画面を開く。
2.  招待したいユーザーのメールアドレスを入力し、権限（例: 「編集可能」）を選択する。
3.  「招待」ボタンをクリックする。
4.  システムは、入力されたメールアドレスのユーザーが存在するか確認する。
5.  存在する場合、`projects_users`テーブルに新しいレコードを追加し、招待を完了する。（MVPでは招待メールの送信はスコープ外とする）
6.  参加者一覧に、新しく追加されたユーザーが即座に表示される。

### 正常系フロー（権限変更）
1.  ユーザーは参加者一覧から、権限を変更したいユーザーを見つける。
2.  そのユーザーの権限ドロップダウンをクリックし、新しい権限（例: 「閲覧のみ」）を選択する。
3.  システムは`projects_users`テーブルの`role`カラムを更新する。
4.  画面上の表示が新しい権限に更新される。

### 異常系フロー
- **存在しないユーザーを招待**:
  - 登録されていないメールアドレスを入力して招待しようとした場合、「このメールアドレスのユーザーは見つかりません」というエラーメッセージを表示する。
- **既に招待済みのユーザー**:
  - 既に参加しているユーザーのメールアドレスを入力した場合、「このユーザーは既に参加しています」というエラーメッセージを表示する。
- **権限がない操作**:
  - 「閲覧のみ」権限のユーザーが参加者管理画面にアクセスしようとした場合、メニューは非表示または無効化されている。
