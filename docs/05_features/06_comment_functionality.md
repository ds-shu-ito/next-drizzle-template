# 5.6. 機能仕様書: コメント機能

## 機能概要
各タスクに対して、ユーザーが進捗報告やメモ、質問などをテキストで記録できる機能。MVP（Minimum Viable Product）では簡易的なコメントの追加と表示のみを実装する。

---

### ユーザーストーリー
- ユーザーとして、タスクに関するメモや更新情報を記録したい。なぜなら、後から経緯を振り返ったり、他のメンバーに状況を伝えたりしたいからだ。
- ユーザーとして、他のメンバーのコメントを読んでタスクの状況を把握したい。なぜなら、非同期でも円滑にコミュニケーションを取りたいからだ。

---

### 画面構成要素
- **コメント入力エリア**:
  - タスク詳細モーダル内に配置する。
  - テキストエリアと「送信」ボタンで構成される。
- **コメント一覧エリア**:
  - 入力エリアの下に、投稿されたコメントを時系列（新しいものが上）で表示する。
  - 各コメントには、投稿者のアイコン、名前、投稿日時、コメント本文を表示する。
  - MVPではコメントの編集・削除機能は実装しない。

---

### 正常系フロー（コメント投稿）
1.  ユーザーはカンバンボードでタスクカードをクリックし、タスク詳細モーダルを開く。
2.  モーダル内のコメント入力エリアにテキストを入力する。
3.  「送信」ボタンをクリックする。
4.  システムは`comments`テーブルに新しいコメントを保存する。
5.  コメント一覧の最上部に、投稿したコメントが即座に追加表示される。
6.  入力エリアのテキストは空になる。

### 異常系フロー
- **空のコメントを投稿**:
  - テキストエリアが空の状態で「送信」ボタンをクリックした場合、何も処理は行われず、エラーも表示しない。ボタンは実質的に無反応となる。
- **権限がない場合**:
  - 「閲覧のみ」権限のユーザーには、コメント入力エリア自体が表示されない。コメント一覧の閲覧は可能。
- **サーバーエラー**:
  - データベースへの保存に失敗した場合、「コメントの投稿に失敗しました」というトーストメッセージを表示する。入力エリアのテキストは保持される。
