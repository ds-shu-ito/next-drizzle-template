# 5.2. 機能仕様書: タスク管理

## 機能概要
ユーザーはプロジェクト内でタスクを作成し、そのステータス、担当者、期限、優先度などを管理できる。タスクの内容は編集・削除が可能。ドラッグ&ドロップによる直感的なステータス変更をサポート。

---

### ユーザーストーリー
- ユーザーとして、プロジェクト内に新しいタスクを追加したい。なぜなら、やるべきことを明確にしたいからだ。
- ユーザーとして、タスクのステータスを「未着手」→「進行中」→「完了」と変更したい。なぜなら、進捗状況をチームに共有したいからだ。
- ユーザーとして、タスクに担当者と期限を設定したい。なぜなら、責任と締め切りを明確にしたいからだ。
- ユーザーとして、タスクの詳細を編集・削除したい。なぜなら、要件変更や不要なタスクに対応したいからだ。

---

### 画面構成要素
- **カンバンボード形式**: 「未着手」「進行中」「完了」の3つのカラムでタスクカードを表示
- **タスクカード**: タスクのタイトル、現在のステータス、優先度、担当者、期限を表示。期限切れのタスクは赤色でハイライト
- **ステータス変更ボタン**: タスクカード内に「← 未着手へ」「→ 進行中へ」「→ 完了へ」のボタンを表示
- **タスク作成ボタン**: 各カラムに「+ タスクを追加」ボタンを配置
- **タスク詳細モーダル**: タスクカードをクリックすると、タイトル、説明、担当者、期限、優先度を編集できるモーダルが表示

---

### 正常系フロー（タスク作成）
1.  ユーザーはカンバンボードの任意のカラムにある「+ タスクを追加」ボタンをクリックする。
2.  タスク作成モーダルが表示される。
3.  ユーザーは「タスクタイトル」（必須）、「説明」（任意）、「優先度」、「期限」を入力する。
4.  「作成」ボタンをクリックする。
5.  システムは新しいタスクを選択したステータスでデータベースに保存する。
6.  カンバンボードに新しいタスクカードが即座に追加表示される。

### 正常系フロー（ドラッグ&ドロップによるステータス変更）
1.  ユーザーはカンバンボード上のタスクカードをドラッグする。
2.  ユーザーはタスクカードを別のカラム（例：「未着手」から「進行中」）にドロップする。
3.  システムはタスクのステータスを更新し、データベースに保存する。
4.  画面上のタスクカードの位置が変更される。

### 正常系フロー（ボタンによるステータス変更）
1.  ユーザーはタスクカード内のステータス変更ボタン（例：「→ 進行中へ」）をクリックする。
2.  システムはタスクのステータスを更新し、データベースに保存する。
3.  タスクカードが新しいカラムに移動する。

### 正常系フロー（タスク編集）
1.  ユーザーはタスクカードをクリックしてタスク詳細モーダルを開く。
2.  編集ボタンをクリックして編集モードに切り替える。
3.  タイトル、説明、ステータス、優先度、期限、担当者を編集する。
4.  保存ボタンをクリックして変更を保存する。

### 正常系フロー（タスク削除）
1.  ユーザーはタスク詳細モーダルを開く。
2.  削除ボタンをクリックする。
3.  確認ダイアログが表示される。
4.  確認すると、タスクが削除される。

### 権限管理
- **編集者**: タスクの作成・編集・削除、ステータス変更が可能
- **閲覧者**: タスクの閲覧のみ可能

### 異常系フロー
- **タイトル未入力**:
  - タイトルが空のままタスクを作成しようとした場合、「タスクのタイトルは必須です」というエラーメッセージを表示する。
- **権限がない場合**:
  - 閲覧者権限のユーザーがタスクの作成、編集、削除、ステータス変更を試みた場合、操作は無効化される。
- **サーバーエラー**:
  - データベースへの保存に失敗した場合、「タスクの更新に失敗しました」というエラーメッセージを表示し、UIを操作前の状態に戻す。
- **ドラッグ&ドロップエラー**:
  - タスクを他のタスクの上にドロップした場合、そのタスクと同じステータスに移動する。
